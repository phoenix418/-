namespace _07._11._25
{
    using System;
    using System.Collections.Generic;
    using System.Diagnostics;

    using System.Threading;
    using System.Threading.Tasks;


    class Program
    {
       
        static async Task Main()
        {
            #region --- парллельное вычесление квадрата суммы main--
            long amount = 1;
            for (int i = 2; i <= 250_000; i++)
            {
                amount += i * i;
            }
            for (int i = 250_001; i <= 500_000; i++)
            {
                amount += i * i;
            }
            for (int i = 500_001; i <= 750_000; i++)
            {
                amount += i * i;
            }
            for (int i = 750_001; i <= 1000000; i++)
            {
                amount += i * i;

                Task<(long total, long time)> CalcTask = Task.Run(CalcukateWhithTask);
                var сalculateMult = CalculateMult();
                Console.WriteLine($"CalculateMult: сумма = {сalculateMult.total} | время = {сalculateMult.time}");
                //реш 2
                var calcTask = await CalcukateWhithTask();
                Console.WriteLine($"CalcukateWhithTask: сумма = {calcTask.total} | время = {calcTask.time}");
                //реш 3
                var сalculateSynck = CalculateSynck();
                Console.WriteLine($"CalculateSynck: сумма = {сalculateSynck.total} | время = {сalculateSynck.time}");

                PrintAvialableTreadInfo();
                Console.WriteLine();
                Console.WriteLine();
                #endregion
    
            }

            #region --- парллельное вычесление квадрата суммы --
            static void PrintAvialableTreadInfo()
            {
                ThreadPool.GetAvailableThreads(out int workertAvialable, out int compketionPortAvialable);
                ThreadPool.GetMaxThreads(out int workerMaxtAvialable, out int compketionMaxPortAvialable);
                ThreadPool.GetMinThreads(out int workertMinAvialable, out int compketionMinPortAvialable);
                Console.WriteLine($"Доступно потоков {workertAvialable}/{workerMaxtAvialable}");
                Console.WriteLine($"минимум доступных потоков {workertMinAvialable}");
                Console.WriteLine($"Доступны i/p потоков {compketionPortAvialable}");
            }



            //1 решение через потоки 

            static (long total, long time) CalculateMult()
            {
                var stopwatch = Stopwatch.StartNew();

                long amount_1 = 0;
                long amount_2 = 0;
                long amount_3 = 0;
                long amount_4 = 0;
                long total_amount = 0;
                Thread firstDbThread = new Thread(() => { amount_1 = FirstDb(); });
                Thread secondDbThread = new Thread(() => { amount_2 = SecondtDb(); });
                Thread thirdtDbThread = new Thread(() => { amount_3 = ThirdtDb(); });
                Thread fourthtDbThread = new Thread(() => { amount_4 = FourthtDb(); });

                firstDbThread.Start();
                secondDbThread.Start();
                thirdtDbThread.Start();
                fourthtDbThread.Start();

                firstDbThread.Join();
                secondDbThread.Join();
                thirdtDbThread.Join();
                fourthtDbThread.Join();

                total_amount = amount_1 + amount_2 + amount_3 + amount_4;
                stopwatch.Stop();
                return (total_amount, stopwatch.ElapsedMilliseconds);



            }

            //решение 2 - через Tasks
            static async Task<(long total, long time)> CalcukateWhithTask()
            {
                var stopwatch = Stopwatch.StartNew();
                // CPU - Bound
                Task<long> t1 = Task.Run(FirstDb);
                Task<long> t2 = Task.Run(SecondtDb);
                Task<long> t3 = Task.Run(ThirdtDb);
                Task<long> t4 = Task.Run(FourthtDb);

                //// ожидания 1 задачи 
                //await t1;
                ////или
                //t1.Wait();

                //пример ожидания самой задачи:
                //await Task.WhenAny(t1, t2, t3, t4);   

                ////Ожидание всех задач
                await Task.WhenAll(t1, t2, t3, t4);
                ////или
                //Task.WaitAll(t1, t2, t3, t4);

                long amount = t1.Result + t2.Result + t3.Result + t4.Result;
                stopwatch.Stop();
                return (amount, stopwatch.ElapsedMilliseconds);
            }

            //решение 3 - через главный поток(синхронно)

            static (long total, long time) CalculateSynck()
            {
                var stopwatch = Stopwatch.StartNew();

                long amount_1 = 0;
                long amount_2 = 0;
                long amount_3 = 0;
                long amount_4 = 0;
                long total_amount = 0;
                amount_1 = FirstDb();
                amount_2 = SecondtDb();
                amount_3 = ThirdtDb();
                amount_4 = FourthtDb();

                total_amount = amount_1 + amount_2 + amount_3 + amount_4;
                stopwatch.Stop();
                return (total_amount, stopwatch.ElapsedMilliseconds);



            }



            //1 диапазон 
            static long FirstDb()
            {
                long amount = 0;
                for (long i = 1; i <= 250_000; i++)
                {
                    amount += i * i;
                }
                return amount;
            }

            //2 диапазон 
            static long SecondtDb()
            {
                long amount = 0;
                for (long i = 250_001; i <= 500_000; i++)
                {
                    amount += i * i;
                }
                return amount;
            }

            //3 диапазон 
            static long ThirdtDb()
            {
                long amount = 0;
                for (long i = 500_001; i <= 750_000; i++)
                {
                    amount += i * i;
                }
                return amount;
            }

            //4 диапазон 
            static long FourthtDb()
            {
                long amount = 0;
                for (long i = 750_001; i <= 1_000_000; i++)
                {
                    amount += i * i;
                }
                return amount;
            }



            #endregion
       


        }
    }
}

